{% extends "base.html" %}

{% block title %}ê´€ë¦¬ì ê´€ë¦¬ - BO System{% endblock %}

{% block extra_styles %}
<style>
  .add-form input,
  .pwd-form input {
    padding: 8px;
    margin-right: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
  }

  .btn-add,
  .btn-pwd {
    padding: 8px 20px;
    background: #3498db;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  }

  .btn-del {
    color: #e74c3c;
    text-decoration: none;
    font-size: 14px;
  }

  .pwd-section {
    display: none;
    margin-top: 20px;
    padding-top: 20px;
    border-top: 2px dashed #eee;
  }
</style>
{% endblock %}
{% block content %}
<div class="header">
  <span style="font-size: 18px"
    >í™˜ì˜í•©ë‹ˆë‹¤, <b>{{ admin_email }}</b> ê´€ë¦¬ìë‹˜</span
  >
  <a href="/logout" class="logout-btn">ë¡œê·¸ì•„ì›ƒ</a>
</div>
<div class="card">
  <h3>ğŸ‘¥ ì‹ ê·œ ê´€ë¦¬ì ì¶”ê°€</h3>
  <form action="/admin/users/add" method="post" class="add-form">
    <input type="text" name="name" placeholder="ì´ë¦„" required />
    <input
      type="email"
      name="email"
      placeholder="ì´ë©”ì¼ ì•„ì´ë””"
      required
    />
    <input
      type="password"
      name="password"
      placeholder="ë¹„ë°€ë²ˆí˜¸"
      required
    />
    <button type="submit" class="btn-add">ì¶”ê°€í•˜ê¸°</button>
  </form>
</div>

<div class="card">
  <h3>ğŸ“‹ ê´€ë¦¬ì ëª©ë¡</h3>
  <form id="userForm" action="/admin/users/change-password" method="post">
    <table>
      <thead>
        <tr>
          <th>
            <input
              type="checkbox"
              id="selectAll"
              onclick="toggleSelectAll(this)"
            />
          </th>
          <th>ì´ë¦„</th>
          <th>ì´ë©”ì¼</th>
          <th>ê´€ë¦¬</th>
        </tr>
      </thead>
      <tbody>
        {% for u in users %}
        <tr>
          <td>
            <input
              type="checkbox"
              name="selected_emails"
              value="{{ u.email }}"
              onclick="updateVisibility()"
            />
          </td>
          <td>{{ u.name }}</td>
          <td>{{ u.email }}</td>
          <td>
            {% if u.email != admin_email %}
            <a
              href="/admin/users/delete/{{ u.email }}"
              class="btn-del"
              onclick="return confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')"
              >ì‚­ì œ</a
            >
            {% else %}
            <span style="color: #aaa">ì‚­ì œë¶ˆê°€(ë³¸ì¸)</span>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <div id="pwdSection" class="pwd-section">
      <h4>ğŸ”’ ì„ íƒí•œ ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</h4>
      <div class="pwd-form">
        <input
          type="password"
          name="new_password"
          placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥"
          id="newPwdInput"
        />
        <button
          type="submit"
          class="btn-pwd"
          onclick="return validatePwd()"
        >
          ë³€ê²½ ì ìš©
        </button>
      </div>
    </div>
  </form>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
  // ì „ì²´ ì„ íƒ/í•´ì œ
  function toggleSelectAll(source) {
    const checkboxes = document.getElementsByName("selected_emails");
    for (let i = 0; i < checkboxes.length; i++) {
      checkboxes[i].checked = source.checked;
    }
    updateVisibility();
  }

  // ì²´í¬ë°•ìŠ¤ ìƒíƒœì— ë”°ë¼ ë³€ê²½ í¼ ë…¸ì¶œ ì—¬ë¶€ ê²°ì •
  function updateVisibility() {
    const checkboxes = document.getElementsByName("selected_emails");
    const pwdSection = document.getElementById("pwdSection");
    let anyChecked = false;
    for (let i = 0; i < checkboxes.length; i++) {
      if (checkboxes[i].checked) {
        anyChecked = true;
        break;
      }
    }
    pwdSection.style.display = anyChecked ? "block" : "none";
  }

  // ìœ íš¨ì„± ê²€ì‚¬
  function validatePwd() {
    const pwd = document.getElementById("newPwdInput").value;
    if (!pwd) {
      alert("ë³€ê²½í•  ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      return false;
    }
    return confirm("ì„ íƒí•œ ê´€ë¦¬ìë“¤ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
  }
</script>
{% endblock %}

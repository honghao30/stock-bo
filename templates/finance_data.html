{% extends "base.html" %}

{% block title %}ê¸ˆìœµìœ„ì›íšŒ ë°ì´í„° í™•ì¸ - BO System{% endblock %}

{% block extra_styles %}
<style>
  .data-section {
    margin-bottom: 30px;
  }

  .data-section h3 {
    color: #2c3e50;
    border-bottom: 2px solid #3498db;
    padding-bottom: 10px;
    margin-bottom: 20px;
  }

  .btn-fetch {
    padding: 10px 20px;
    background: #3498db;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    margin-right: 10px;
    margin-bottom: 10px;
  }

  .btn-fetch:hover {
    background: #2980b9;
  }

  .data-display {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 4px;
    padding: 15px;
    margin-top: 15px;
    max-height: 500px;
    overflow-y: auto;
  }

  .data-display pre {
    margin: 0;
    font-size: 12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  .loading {
    color: #3498db;
    font-style: italic;
  }

  .error {
    color: #e74c3c;
    background: #f8d7da;
    padding: 10px;
    border-radius: 4px;
  }

  .success {
    color: #155724;
    background: #d4edda;
    padding: 10px;
    border-radius: 4px;
    margin-bottom: 10px;
  }

  .info-badge {
    display: inline-block;
    padding: 4px 8px;
    background: #e8f4fd;
    color: #2980b9;
    border-radius: 4px;
    font-size: 12px;
    margin-left: 10px;
  }
</style>
{% endblock %}

{% block content %}
<div class="card">
  <h2 style="color: #2c3e50; margin-top: 0">ğŸ“Š ê¸ˆìœµìœ„ì›íšŒ ë°ì´í„° í™•ì¸</h2>
  <p style="color: #666">
    ê¸ˆìœµìœ„ì›íšŒ ê³µê°œë°ì´í„°í¬í„¸ì—ì„œ ì œê³µí•˜ëŠ” 3ê°€ì§€ API ë°ì´í„°ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  </p>
  <hr style="border: 0; border-top: 1px solid #eee; margin: 25px 0" />

  <!-- ê³µì‹œì •ë³´ -->
  <div class="data-section">
    <h3>
      ğŸ“‹ ê³µì‹œì •ë³´ (GetDiscInfoService_V2)
      <span class="info-badge" id="disclosure-status">ëŒ€ê¸°ì¤‘</span>
    </h3>
    <button class="btn-fetch" onclick="fetchDisclosureInfo()">
      ê³µì‹œì •ë³´ ê°€ì ¸ì˜¤ê¸°
    </button>
    <div id="disclosure-data" class="data-display" style="display: none;"></div>
  </div>

  <!-- ì£¼ì‹ë°œí–‰ ê³µì‹œì •ë³´ -->
  <div class="data-section">
    <h3>
      ğŸ“ˆ ì£¼ì‹ë°œí–‰ ê³µì‹œì •ë³´
      <span class="info-badge" id="issuance-status">ëŒ€ê¸°ì¤‘</span>
    </h3>
    <button class="btn-fetch" onclick="fetchStockIssuance()">
      ì£¼ì‹ë°œí–‰ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
    </button>
    <div id="issuance-data" class="data-display" style="display: none;"></div>
  </div>

  <!-- ì£¼ì‹ì‹œì„¸ì •ë³´ -->
  <div class="data-section">
    <h3>
      ğŸ’¹ ì£¼ì‹ì‹œì„¸ì •ë³´
      <span class="info-badge" id="price-status">ëŒ€ê¸°ì¤‘</span>
    </h3>
    <button class="btn-fetch" onclick="fetchStockPrice()">
      ì£¼ì‹ì‹œì„¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
    </button>
    <div id="price-data" class="data-display" style="display: none;"></div>
  </div>

  <!-- ì „ì²´ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° -->
  <div class="data-section">
    <h3>ğŸ”„ ì „ì²´ ë°ì´í„° ì¼ê´„ ìˆ˜ì§‘</h3>
    <button class="btn-fetch" onclick="fetchAllData()" style="background: #27ae60;">
      ëª¨ë“  ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    </button>
    <div id="all-data" class="data-display" style="display: none;"></div>
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
  async function fetchDisclosureInfo() {
    const statusEl = document.getElementById('disclosure-status');
    const dataEl = document.getElementById('disclosure-data');
    
    statusEl.textContent = 'ë¡œë”©ì¤‘...';
    statusEl.style.background = '#fff3cd';
    statusEl.style.color = '#856404';
    dataEl.style.display = 'block';
    dataEl.innerHTML = '<div class="loading">ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...</div>';

    try {
      const response = await fetch('/api/disclosure-info?page_no=1&num_of_rows=10');
      const data = await response.json();
      
      statusEl.textContent = 'ì™„ë£Œ';
      statusEl.style.background = '#d4edda';
      statusEl.style.color = '#155724';
      dataEl.innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
    } catch (error) {
      statusEl.textContent = 'ì˜¤ë¥˜';
      statusEl.style.background = '#f8d7da';
      statusEl.style.color = '#721c24';
      dataEl.innerHTML = '<div class="error">ì˜¤ë¥˜ ë°œìƒ: ' + error.message + '</div>';
    }
  }

  async function fetchStockIssuance() {
    const statusEl = document.getElementById('issuance-status');
    const dataEl = document.getElementById('issuance-data');
    
    statusEl.textContent = 'ë¡œë”©ì¤‘...';
    statusEl.style.background = '#fff3cd';
    statusEl.style.color = '#856404';
    dataEl.style.display = 'block';
    dataEl.innerHTML = '<div class="loading">ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...</div>';

    try {
      const response = await fetch('/api/stock-issuance?page_no=1&num_of_rows=10');
      const data = await response.json();
      
      statusEl.textContent = 'ì™„ë£Œ';
      statusEl.style.background = '#d4edda';
      statusEl.style.color = '#155724';
      dataEl.innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
    } catch (error) {
      statusEl.textContent = 'ì˜¤ë¥˜';
      statusEl.style.background = '#f8d7da';
      statusEl.style.color = '#721c24';
      dataEl.innerHTML = '<div class="error">ì˜¤ë¥˜ ë°œìƒ: ' + error.message + '</div>';
    }
  }

  async function fetchStockPrice() {
    const statusEl = document.getElementById('price-status');
    const dataEl = document.getElementById('price-data');
    
    statusEl.textContent = 'ë¡œë”©ì¤‘...';
    statusEl.style.background = '#fff3cd';
    statusEl.style.color = '#856404';
    dataEl.style.display = 'block';
    dataEl.innerHTML = '<div class="loading">ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...</div>';

    try {
      const response = await fetch('/api/stock-price?page_no=1&num_of_rows=10');
      const data = await response.json();
      
      statusEl.textContent = 'ì™„ë£Œ';
      statusEl.style.background = '#d4edda';
      statusEl.style.color = '#155724';
      dataEl.innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
    } catch (error) {
      statusEl.textContent = 'ì˜¤ë¥˜';
      statusEl.style.background = '#f8d7da';
      statusEl.style.color = '#721c24';
      dataEl.innerHTML = '<div class="error">ì˜¤ë¥˜ ë°œìƒ: ' + error.message + '</div>';
    }
  }

  async function fetchAllData() {
    const dataEl = document.getElementById('all-data');
    dataEl.style.display = 'block';
    dataEl.innerHTML = '<div class="loading">ëª¨ë“  ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...</div>';

    try {
      const response = await fetch('/api/fetch-data');
      const result = await response.json();
      
      if (result.success) {
        dataEl.innerHTML = '<div class="success">âœ… ëª¨ë“  ë°ì´í„° ìˆ˜ì§‘ ì™„ë£Œ!</div><pre>' + 
          JSON.stringify(result.data, null, 2) + '</pre>';
      } else {
        dataEl.innerHTML = '<div class="error">ì˜¤ë¥˜: ' + (result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜') + '</div>';
      }
    } catch (error) {
      dataEl.innerHTML = '<div class="error">ì˜¤ë¥˜ ë°œìƒ: ' + error.message + '</div>';
    }
  }
</script>
{% endblock %}


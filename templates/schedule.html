{% extends "base.html" %}

{% block title %}ì¼ì • ê´€ë¦¬ - BO System{% endblock %}

{% block extra_styles %}
<style>
  .flex-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .btn-sync {
    padding: 10px 20px;
    background: #27ae60;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
  }

  .badge-manual {
    background: #d1ecf1;
    color: #0c5460;
  }

  .badge-api {
    background: #fff3cd;
    color: #856404;
  }

  .add-form input {
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    margin-right: 10px;
  }

  .btn-add {
    padding: 10px 25px;
    background: #3498db;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  }

  /* ìˆ˜ì • ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
  #editModal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    justify-content: center;
    align-items: center;
  }

  .modal-content {
    background: white;
    padding: 30px;
    border-radius: 10px;
    width: 400px;
  }

  .modal-content input {
    width: 100%;
    padding: 10px;
    margin: 10px 0;
    box-sizing: border-box;
  }

  .btn-group {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    margin-top: 20px;
  }
</style>
{% endblock %}

{% block content %}
<div class="card flex-header">
  <h3>ğŸ“… ì¼ì • ê´€ë¦¬ ë° API ë™ê¸°í™”</h3>
  <form action="/admin/schedule/sync-api" method="post">
    <button type="submit" class="btn-sync">ğŸ”„ API ë¶ˆëŸ¬ì˜¤ê¸°</button>
  </form>
</div>

<div class="card">
  <h4>â• ìƒˆ ì¼ì • ë“±ë¡</h4>
  <form action="/admin/schedule/add" method="post" class="add-form">
    <input type="date" name="date" required />
    <input
      type="text"
      name="title"
      placeholder="ì¼ì • ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"
      style="width: 300px"
      required
    />
    <button type="submit" class="btn-add">ì¶”ê°€</button>
  </form>
</div>

<div class="card">
  <h4>ğŸ“‹ ì¼ì • ë¦¬ìŠ¤íŠ¸</h4>
  <table>
    <thead>
      <tr>
        <th>ë‚ ì§œ</th>
        <th>êµ¬ë¶„</th>
        <th>ì¼ì • ë‚´ìš©</th>
        <th>ê´€ë¦¬</th>
      </tr>
    </thead>
    <tbody>
      {% for s in schedules %}
      <tr>
        <td style="font-weight: bold">{{ s.date }}</td>
        <td>
          <span
            class="badge {{ 'badge-api' if s.type == 'api' else 'badge-manual' }}"
            >{{ 'API' if s.type == 'api' else 'ìˆ˜ë™' }}</span
          >
        </td>
        <td>{{ s.title }}</td>
        <td>
          <button
            onclick="openEditModal('{{ s.id }}', '{{ s.date }}', '{{ s.title }}')"
            style="
              color: #3498db;
              background: none;
              border: none;
              cursor: pointer;
              padding: 0;
              font-size: 14px;
              margin-right: 10px;
            "
          >
            ìˆ˜ì •
          </button>
          <a
            href="/admin/schedule/delete/{{ s.id }}"
            style="color: #e74c3c; text-decoration: none; font-size: 14px"
            onclick="return confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')"
            >ì‚­ì œ</a
          >
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div id="editModal">
  <div class="modal-content">
    <h3>ğŸ“ ì¼ì • ìˆ˜ì •</h3>
    <form action="/admin/schedule/update" method="post">
      <input type="hidden" name="sch_id" id="edit_id" />
      <label>ë‚ ì§œ</label>
      <input type="date" name="date" id="edit_date" required />
      <label>ë‚´ìš©</label>
      <input type="text" name="title" id="edit_title" required />
      <div class="btn-group">
        <button
          type="button"
          onclick="closeEditModal()"
          style="padding: 10px; border: none; cursor: pointer"
        >
          ì·¨ì†Œ
        </button>
        <button type="submit" class="btn-add">ìˆ˜ì • ì™„ë£Œ</button>
      </div>
    </form>
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
  function openEditModal(id, date, title) {
    document.getElementById("edit_id").value = id;
    document.getElementById("edit_date").value = date;
    document.getElementById("edit_title").value = title;
    document.getElementById("editModal").style.display = "flex";
  }

  function closeEditModal() {
    document.getElementById("editModal").style.display = "none";
  }

  window.onclick = function (event) {
    let modal = document.getElementById("editModal");
    if (event.target == modal) closeEditModal();
  };
</script>
{% endblock %}
